# üöÄ –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–æ–¥–∞–∫—à–Ω Telegram Bot

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π, –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –±–æ—Ç —Å webhook –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö cloud –ø–ª–∞—Ç—Ñ–æ—Ä–º.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **Webhook –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **PostgreSQL** - –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö  
- **Memory cache** - –±—ã—Å—Ç—Ä–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏
- **–ê–≤—Ç–æ–ø–∏–Ω–≥** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞—Å—ã–ø–∞–Ω–∏—è (–∫–∞–∂–¥—ã–µ 25 –º–∏–Ω—É—Ç)
- **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
- **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –º–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## üèóÔ∏è –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Users ‚Üí Telegram ‚Üí Webhook ‚Üí aiogram ‚Üí PostgreSQL
                              ‚Üì
                         Memory Cache
```

**–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:**
- ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç —Å webhook
- ‚úÖ PostgreSQL (3 —Ç–∞–±–ª–∏—Ü—ã: user_ads, banned_users, user_limits)  
- ‚úÖ Memory storage –¥–ª—è FSM
- ‚úÖ Memory cache –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –≤ Telegram
- ‚úÖ –ê–≤—Ç–æ–ø–∏–Ω–≥ /health endpoint

**–ß—Ç–æ —É–±—Ä–∞–Ω–æ:**
- ‚ùå Redis (–∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –ø–∞–º—è—Ç—å)
- ‚ùå Web API –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ùå –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ endpoints
- ‚ùå Background cron –∑–∞–¥–∞—á–∏
- ‚ùå –¢–∞–±–ª–∏—Ü—ã –ª–æ–≥–æ–≤/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
git clone <repository>
cd telegram-bot

# –ö–æ–ø–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.template .env

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
nano .env
```

### 2. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ PostgreSQL + Bot (–±–µ–∑ Redis)
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### 3. –î–µ–ø–ª–æ–π –Ω–∞ Render.com

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫ Render**
2. **–°–æ–∑–¥–∞–π—Ç–µ PostgreSQL —Å–µ—Ä–≤–∏—Å:**
   - Plan: Free
   - Database Name: `telegram_bot`

3. **–°–æ–∑–¥–∞–π—Ç–µ Web Service:**
   - Runtime: Docker
   - Plan: Free
   - Auto-deploy: –≤–∫–ª—é—á–µ–Ω

4. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
DATABASE_URL=<–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏_–∏–∑_postgres>
TARGET_CHAT_ID=-1002827106973
MODERATION_CHAT_ID=–≤–∞—à_id_–≥—Ä—É–ø–ø—ã_–º–æ–¥–µ—Ä–∞—Ü–∏–∏
WEBHOOK_HOST=https://your-app-name.onrender.com
GROUP_LINK=https://t.me/your_group
EXAMPLE_URL=https://example.com
```

5. **Deploy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è!**

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

```bash
# Health check (—Å –∞–≤—Ç–æ–ø–∏–Ω–≥–æ–º –∫–∞–∂–¥—ã–µ 25 –º–∏–Ω—É—Ç)
curl https://your-app-name.onrender.com/health
```

## üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –≤ Telegram

–í –≥—Ä—É–ø–ø–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã:

- `/ban <user_id>` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/banoff <user_id>` - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
- `/setlimit <user_id> <limit>` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- `/getlimit <user_id>` - —É–∑–Ω–∞—Ç—å –ª–∏–º–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–π

–ò–∑–º–µ–Ω–∏—Ç–µ —Å–ª–æ–≤–∞—Ä—å `TOPICS` –≤ —Ñ–∞–π–ª–µ `main.py`:

```python
TOPICS = {
    "topic_1": TopicInfo(name="üíº –†–∞–±–æ—Ç–∞", id=27),
    "topic_2": TopicInfo(name="üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å", id=28),
    # ... –≤–∞—à–∏ —Ç–µ–º—ã
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```bash
curl https://your-app.onrender.com/health
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T12:00:00",
  "bot_id": 123456789
}
```

### –ê–≤—Ç–æ–ø–∏–Ω–≥
–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∏–Ω–≥—É–µ—Ç —Å–µ–±—è –∫–∞–∂–¥—ã–µ 25 –º–∏–Ω—É—Ç —á–µ—Ä–µ–∑ `/health` endpoint, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –∑–∞—Å—ã–ø–∞–Ω–∏–µ –Ω–∞ Render.com.

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Rate limiting**: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ URL, @username, —Ö—ç—à—Ç–µ–≥–∏
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã**: –∑–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π
- **Memory isolation**: –∫—ç—à –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **Memory cache —Å TTL**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ –∫—ç—à–∞
- **Connection pooling**: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏ –Ω–∏–∑–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

## üö® Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint
curl https://your-app.com/health

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook –≤ Telegram
curl "https://api.telegram.org/bot<TOKEN>/getWebhookInfo"
```

### –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é DATABASE_URL
echo $DATABASE_URL

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# –í Render Dashboard ‚Üí Logs
```

### –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
```bash
# Render Free: 512MB RAM
# –ë–æ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —ç—Ç–æ–≥–æ –ª–∏–º–∏—Ç–∞
# Memory cache –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ TTL
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ main.py              # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª (–≤—Å–µ –≤ –æ–¥–Ω–æ–º)
‚îú‚îÄ‚îÄ requirements.txt     # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏  
‚îú‚îÄ‚îÄ Dockerfile          # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îú‚îÄ‚îÄ docker-compose.yml  # –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
‚îú‚îÄ‚îÄ init.sql            # –°—Ö–µ–º–∞ –ë–î (3 —Ç–∞–±–ª–∏—Ü—ã)
‚îú‚îÄ‚îÄ .env.template       # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ render.yaml         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Render
‚îî‚îÄ‚îÄ README.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üéØ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **RAM**: 256MB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 512MB)
- **PostgreSQL**: –ª—é–±–∞—è –≤–µ—Ä—Å–∏—è 12+
- **Python**: 3.11+
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: 6 –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

## ‚úÖ Checklist –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] **BOT_TOKEN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**
- [ ] **DATABASE_URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω**  
- [ ] **TARGET_CHAT_ID —É–∫–∞–∑–∞–Ω**
- [ ] **Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç (health check 200)**
- [ ] **–ë–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞ –≤ –≥—Ä—É–ø–ø–µ**
- [ ] **–¢–µ–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ ID**
- [ ] **–ö–æ–º–∞–Ω–¥—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã**

---

**üéâ –ì–æ—Ç–æ–≤–æ! –í–∞—à —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–æ–¥–∞–∫—à–Ω –±–æ—Ç –∑–∞–ø—É—â–µ–Ω!**

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –º–∏–Ω–∏–º–∞–ª–∏–∑–º–∞ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:
- **–û–¥–Ω–∏–π —Ñ–∞–π–ª** - –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ main.py
- **–ú–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ
- **Memory-first** - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
- **Self-healing** - –∞–≤—Ç–æ–ø–∏–Ω–≥ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤! üöÄ
